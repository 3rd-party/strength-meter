/*!
 * @copyright &copy; Kartik Visweswaran, Krajee.com, 2013
 * @version 1.0.0
 * 
 * A dynamic strength meter for password input validation with various configurable options.
 * 
 * Enhancement of password meter created by Jeff Todnem (http://www.todnem.com/)
 * 
 * Built originally for Yii Framework 2.0. But is usable across frameworks & scenarios.
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */
(function(e){String.prototype.strReverse=function(){var e="";for(var t=0;t<this.length;t++){e=this.charAt(t)+e}return e};var t=function(t,n){return t===null||t===undefined||t==[]||t===""||n&&e.trim(t)===""};var n=function(e,t){var n="#"+e.attr("id");e.clone(true).attr("type",t).insertAfter(n).prev().remove()};var r=function(e){if(e===null){return 0}if(e<=0){return 0}if(e>=100){return 5}if(e<=20){return 1}if(e>20&&e<=40){return 2}if(e>40&&e<=60){return 3}if(e>60&&e<=80){return 4}if(e>80&&e<100){return 5}};var i=function(e,t){var n=0,r=0,i=0,s=0,o=0,u=0,a=0,f=0,l=0,c=0,h=0,p=0,d=0,v=0,m=0,g=0,y=0,b=0,w=0;var E=t.midChar,S=t.consecAlphaUC,x=t.consecAlphaLC,T=t.consecNumber;var N=t.seqAlpha,C=t.seqNumber,k=t.seqSymbol;var L=t.length,A=t.number,O=t.symbol;var M="",_="",D="",P="";var H="abcdefghijklmnopqrstuvwxyz";var B="01234567890";var j=")!@#$%^&*()";if(e){n=parseInt(e.length*L);r=e.length;var F=e.replace(/\s+/g,"").split(/\s*/);var I=F.length;var q="";for(var R=0;R<I;R++){q=F[R];if(q.toUpperCase()!=q){if(M!==""&&M+1==R){h++;m++}M=R;i++}else if(q.toLowerCase()!=q){if(_!==""&&_+1==R){p++;m++}_=R;s++}else if(q.match(/[0-9]/g)){if(R>0&&R<I-1){a++}if(D!==""&&D+1==R){d++;m++}D=R;o++}else if(q.match(/[^\w]/g)){if(R>0&&R<I-1){a++}if(P!==""&&P+1==R){v++;m++}P=R;u++}var U=false;for(var z=0;z<I;z++){if(F[R]==F[z]&&R!=z){U=true;c+=Math.abs(I/(z-R))}}if(U){l++;f=I-l;c=f?Math.ceil(c/f):Math.ceil(c)}}for(var W=0;W<23;W++){var X=H.substring(W,parseInt(W+3));var V=X.strReverse();if(e.toLowerCase().indexOf(X)!=-1||e.toLowerCase().indexOf(V)!=-1){g++;w++}}for(var W=0;W<8;W++){var X=B.substring(W,parseInt(W+3));var V=X.strReverse();if(e.toLowerCase().indexOf(X)!=-1||e.toLowerCase().indexOf(V)!=-1){y++;w++}}for(var W=0;W<8;W++){var X=j.substring(W,parseInt(W+3));var V=X.strReverse();if(e.toLowerCase().indexOf(X)!=-1||e.toLowerCase().indexOf(V)!=-1){b++;w++}}if(i>0&&i<r){n=parseInt(n+(r-i)*2)}if(s>0&&s<r){n=parseInt(n+(r-s)*2)}if(o>0&&o<r){n=parseInt(n+o*A)}if(u>0){n=parseInt(n+u*O)}if(a>0){n=parseInt(n+a*E)}if((s>0||i>0)&&u===0&&o===0){n=parseInt(n-r)}if(s===0&&i===0&&u===0&&o>0){n=parseInt(n-r)}if(l>0){n=parseInt(n-c)}if(h>0){n=parseInt(n-h*S)}if(p>0){n=parseInt(n-p*x)}if(d>0){n=parseInt(n-d*T)}if(g>0){n=parseInt(n-g*N)}if(y>0){n=parseInt(n-y*C)}if(b>0){n=parseInt(n-b*k)}if(n>100){n=100}else if(n<0){n=0}return n}return 0};var s=function(n,r){this.verdicts=r.verdicts;this.toggleClass=r.toggleClass;this.meterClass=r.meterClass;this.scoreBarClass=r.scoreBarClass;this.scoreClass=r.scoreClass;this.verdictClass=r.verdictClass;this.inputClass=r.inputClass;this.containerClass=r.containerClass;this.inputTemplate=r.inputTemplate;this.meterTemplate=r.meterTemplate;this.mainTemplate=r.mainTemplate;this.config=r.config;this.$element=e(n);this.initialValue=t(this.$element.val())?0:this.$element.val();var s=i(this.initialValue,this.config);this.$container=this.createContainer();this.$elToggle=this.$container.find(".kv-toggle");this.$elScorebar=this.$container.find(".kv-scorebar");this.$elScore=this.$container.find(".kv-score");this.$elVerdict=this.$container.find(".kv-verdict");this.$elScoreInput=e(document.createElement("input")).attr("type","hidden").val(s);this.$container.append(this.$elScoreInput);this.paint(s);this.listen()};s.prototype={constructor:s,listen:function(){var e=this;e.$element.on("keyup",function(t){e.change(t,this.value)});e.$element.closest("form").on("reset",function(){e.reset()});e.$elToggle.on("change",function(){e.toggle()})},paint:function(e){var t=this,n=r(e);var i=t.verdicts[n];t.$elScore.attr("class",t.scoreClass+" "+t.scoreClass+"-"+n);t.$elScorebar.css("background-position",0-parseInt(e*4)+"px");t.$elScore.html(e+"%");t.$elVerdict.html(i)},change:function(e,t){var n=this,r=i(t,n.config);n.$elScoreInput.val(r);n.paint(r);n.$element.trigger("strength.change")},reset:function(){var e=this,t=i(e.initialValue,e.config);e.paint(t);e.$element.trigger("strength.reset")},toggle:function(){var e=this;var t=e.$elToggle.is(":checked")?"text":"password";n(e.$element,t);e.$element.trigger("strength.toggle")},show:function(){var e=this;e.$elScorebar.show();e.$elScore.show();e.$elVerdict.show();e.$element.trigger("strength.show")},hide:function(){var e=this;e.$elScorebar.hide();e.$elScore.hide();e.$elVerdict.hide();e.$element.trigger("strength.hide")},createContainer:function(){var t=this;var n=t.mainTemplate;n=n.replace("{input}",t.renderInput());n=n.replace("{meter}",t.renderMeter());var r=e(document.createElement("div")).attr({"class":t.containerClass}).html(n);t.$element.before(r);var i=r.find(".kv-temporary-input");var s=t.$element.detach();i.before(s);i.remove();return r},renderInput:function(){var e=this,t=e.inputTemplate;e.$element.removeClass(e.inputClass).addClass(e.inputClass);t=t.replace("{input}",'<div class="kv-temporary-input"></div>');t=t.replace("{toggle}",'<input type="checkbox" class="'+e.toggleClass+'">');return t},renderMeter:function(){var e=this,t=e.meterTemplate;t=t.replace("{scorebar}",'<div class="'+e.scoreBarClass+'"></div>');t=t.replace("{score}",'<div class="'+e.scoreClass+'"></div>');t=t.replace("{verdict}",'<div class="'+e.verdictClass+'"></div>');return'<div class="'+e.meterClass+'">'+t+"</div>"}};e.fn.strength=function(t){var n=Array.apply(null,arguments);n.shift();return this.each(function(){var r=e(this),i=r.data("strength"),o=typeof t==="object"&&t;if(!i){r.data("strength",i=new s(this,e.extend({},e.fn.strength.defaults,o,e(this).data())))}if(typeof t==="string"){i[t].apply(i,n)}})};e.fn.strength.defaults={meterClass:"kv-meter",scoreBarClass:"kv-scorebar",scoreClass:"kv-score",verdictClass:"kv-verdict",containerClass:"kv-password",toggleClass:"kv-toggle",inputClass:"form-control",inputTemplate:'<div class="input-group">\n{input}\n<span class="input-group-addon">{toggle}</span>\n</div>',meterTemplate:'<div class="kv-scorebar-border">{scorebar}\n{score}</div>\n{verdict}',mainTemplate:'<div class="row">\n<div class="col-sm-9">\n{input}</div>\n<div class="col-sm-2">{meter}</div></div>',verdicts:{0:'<div class="label label-default">Too Short</div>',1:'<div class="label label-danger">Very Weak</div>',2:'<div class="label label-warning">Weak</div>',3:'<div class="label label-info">Good</div>',4:'<div class="label label-primary">Strong</div>',5:'<div class="label label-success">Very Strong</div>'},config:{midChar:2,consecAlphaUC:2,consecAlphaLC:2,consecNumber:2,seqAlpha:3,seqNumber:3,seqSymbol:3,length:4,number:4,symbol:6}};e(function(){var t=e("input.strength[type=password]");if(t.length>0){t.strength()}})})(jQuery)